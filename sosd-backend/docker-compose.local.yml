version: "3.9"

services:
  app:
    container_name: sosd-local-app
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped

    env_file:
      - .env.local

    environment:
      SPRING_PROFILES_ACTIVE: local

      # DB 접속 정보: 이제 db 컨테이너랑 한 compose 네트워크에 없으니까
      # 호스트로 나갔다가 포트포워딩된 MySQL로 들어간다.
      # 윈도우/맥: host.docker.internal
      # (만약 리눅스라서 host.docker.internal 없으면, 나중에 DB 컨테이너의 브릿지 IP나 custom network로 바꾸면 돼)
      MYSQL_HOST: host.docker.internal
      MYSQL_PORT: ${MYSQL_PORT}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}

      GITHUB_TOKEN: ${GITHUB_TOKEN}

    ports:
      - "8080:8080"

    volumes:
      - ./logs:/app/logs
      - ./.env.local:/app/.env.local:ro